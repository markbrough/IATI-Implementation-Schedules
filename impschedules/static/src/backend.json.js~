this.recline = this.recline || {};
this.recline.Backend = this.recline.Backend || {};
this.recline.Backend.json = this.recline.Backend.json || {};

(function($, my) {
  my.__type__ = 'json';

  // ## Google spreadsheet backend
  // 
  // Fetch data from a Google Docs spreadsheet.
  //
  // Dataset must have a url attribute pointing to the Gdocs or its JSON feed e.g.
  // <pre>
  // var dataset = new recline.Model.Dataset({
  //     url: 'https://docs.google.com/spreadsheet/ccc?key=0Aon3JiuouxLUdGlQVDJnbjZRSU1tUUJWOUZXRG53VkE#gid=0'
  //   },
  //   'gdocs'
  // );
  //
  // var dataset = new recline.Model.Dataset({
  //     url: 'https://spreadsheets.google.com/feeds/list/0Aon3JiuouxLUdDQwZE1JdV94cUd6NWtuZ0IyWTBjLWc/od6/public/values?alt=json'
  //   },
  //   'gdocs'
  // );
  // </pre>
  //
  // @return object with two attributes
  //
  // * fields: array of Field objects
  // * records: array of objects for each row
  my.fetch = function(dataset) {
    var dfd  = $.Deferred(); 
    var url = dataset.url;
    // TODO cover it with tests
    // get the spreadsheet title

      // get the actual worksheet data
      $.getJSON(url, function(d) {
        var result = d.dates;
        var fields = dataset.fields;
        dfd.resolve({
          records       : result,
          fields        : dataset.fields,
          useMemoryStore: true
        });
      });

    return dfd.promise();
 };


}(jQuery, this.recline.Backend.json));
